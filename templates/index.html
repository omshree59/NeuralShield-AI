<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuralShield AI - Enterprise Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- CORE THEME (PREMIUM DARK) --- */
        :root {
            --primary: #6366f1;       /* Indigo */
            --primary-dark: #4338ca;  /* Deep Indigo */
            --secondary: #0f172a;     /* Slate 900 */
            --accent: #818cf8;        /* Light Indigo */
            --text-light: #f8fafc;
            --text-gray: #94a3b8;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            margin: 0; padding: 0; 
            color: var(--text-light);
            background-color: #0f172a;
            /* Static Premium Mesh Background */
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        a { text-decoration: none; color: inherit; transition: 0.3s; }
        * { box-sizing: border-box; }

        /* --- NAVBAR --- */
        nav { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 20px 5%; max-width: 1400px; margin: 0 auto; 
            position: relative; z-index: 10;
        }
        .logo-container { display: flex; align-items: center; gap: 12px; text-decoration: none; }
        .logo-icon-box {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 20px;
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);
        }
        .logo-text { font-size: 22px; font-weight: 800; color: white; letter-spacing: -0.5px; }
        .nav-right { display: flex; align-items: center; gap: 40px; }
        .nav-links { display: flex; gap: 30px; font-size: 15px; color: var(--text-light); font-weight: 600; }
        .nav-links a:hover { color: var(--primary); }
        .auth-buttons { display: flex; gap: 15px; }
        .btn-nav { background: var(--primary); color: white; padding: 10px 24px; border-radius: 8px; font-weight: 600; border: none; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.3); }
        .btn-nav:hover { background: var(--primary-dark); transform: translateY(-1px); box-shadow: 0 6px 12px -1px rgba(99, 102, 241, 0.4); }
        .btn-outline { background: transparent; color: white; border: 1px solid rgba(255,255,255,0.2); margin-left: 0; box-shadow: none; }
        .btn-outline:hover { border-color: white; background: rgba(255,255,255,0.05); }

        /* --- HERO --- */
        .hero { 
            text-align: center; padding: 100px 20px 60px; max-width: 950px; margin: 0 auto; position: relative; z-index: 5; 
        }
        .hero h1 { 
            font-size: 64px; font-weight: 900; margin-bottom: 24px; line-height: 1.1; letter-spacing: -2px;
            background: linear-gradient(to right, #fff 20%, #a5b4fc 40%, #6366f1 60%, #fff 80%);
            background-size: 200% auto;
            color: #000; background-clip: text; text-fill-color: transparent; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: shine 4s linear infinite alternate;
            filter: drop-shadow(0 0 15px rgba(99, 102, 241, 0.4));
        }
        @keyframes shine { to { background-position: 200% center; } }
        .hero p { font-size: 20px; color: var(--text-gray); margin-bottom: 50px; line-height: 1.6; max-width: 600px; margin-left: auto; margin-right: auto; }

        /* --- VISUAL SHOWCASE --- */
        .showcase-container {
            display: flex; justify-content: center; align-items: center; gap: 40px; 
            margin-bottom: 100px; padding: 0 20px; position: relative; z-index: 5;
        }
        .showcase-img { 
            width: 380px; border-radius: 16px; 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); border: 4px solid rgba(255,255,255,0.1);
            transition: transform 0.3s ease; 
        }
        .showcase-img:hover { transform: translateY(-5px) scale(1.02); }
        .arrow-icon { font-size: 30px; color: var(--primary); opacity: 0.8; }

        /* --- DIAGNOSTIC TOOL (ANIMATED BOX) --- */
        .demo-section-title { 
            text-align: center; margin-bottom: 30px; 
            font-size: 28px; font-weight: 700; color: white; letter-spacing: -0.5px; 
        }
        
        /* MODE SWITCHER STYLES */
        .mode-container {
            display: flex; justify-content: center; margin-bottom: 25px; position: relative; z-index: 6;
        }
        .mode-switch {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 50px;
            padding: 6px;
            display: flex;
            gap: 5px;
        }
        .mode-btn {
            padding: 10px 24px;
            border-radius: 40px;
            border: none;
            background: transparent;
            color: var(--text-gray);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex; align-items: center; gap: 8px; font-size: 14px;
        }
        .mode-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }
        .mode-btn:hover:not(.active) { color: white; background: rgba(255,255,255,0.05); }

        .demo-container { 
            background: linear-gradient(120deg, #ffffff 0%, #f0f4ff 50%, #ffffff 100%);
            background-size: 200% 200%;
            animation: iceShimmer 6s ease-in-out infinite;
            
            max-width: 1000px; margin: 0 auto 100px; 
            border-radius: 24px; 
            box-shadow: 0 30px 60px -12px rgba(99, 102, 241, 0.15), 0 0 20px rgba(99,102,241, 0.2); 
            border: 1px solid rgba(255, 255, 255, 0.8); 
            overflow: hidden; display: flex; position: relative; z-index: 5;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        @keyframes iceShimmer {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .demo-container:hover { transform: translateY(-2px); box-shadow: 0 40px 70px -12px rgba(99, 102, 241, 0.3); }

        .demo-input { flex: 1; padding: 50px; border-right: 1px solid rgba(0,0,0,0.05); }
        
        .drop-zone { 
            border: 2px dashed #cbd5e1; border-radius: 16px; padding: 30px; 
            text-align: center; color: var(--text-gray); cursor: pointer; transition: 0.3s; 
            background: rgba(255,255,255,0.6); margin-bottom: 20px;
        }
        .drop-zone:hover { border-color: var(--primary); background: #eef2ff; color: var(--primary); }
        
        textarea { 
            width: 100%; height: 120px; padding: 16px; margin-top: 10px;
            border: 1px solid #e2e8f0; border-radius: 12px; 
            font-family: 'Inter', sans-serif; font-size: 14px; color: #1e293b;
            resize: none; outline: none; transition: 0.3s; background: rgba(255,255,255,0.8);
        }
        textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); background: white; }
        
        .file-status { display: none; margin-top: 15px; padding: 10px 15px; background: #eef2ff; color: var(--primary-dark); border-radius: 8px; font-size: 13px; font-weight: 600; border: 1px solid #c7d2fe; }

        .analyze-btn { 
            width: 100%; padding: 16px; background: var(--primary); color: white; border: none; 
            border-radius: 12px; font-size: 16px; font-weight: 700; margin-top: 24px; 
            cursor: pointer; transition: 0.2s; box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.25);
        }
        .analyze-btn:hover { background: var(--primary-dark); transform: translateY(-1px); }

        /* RIGHT: The Result Area */
        .demo-result { 
            flex: 1; padding: 50px; 
            background: rgba(248, 250, 252, 0.5); 
            display: flex; flex-direction: column; justify-content: center; gap: 20px;
            color: #1e293b;
        }

        .result-card { 
            background: rgba(255,255,255,0.9); padding: 24px; border-radius: 16px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.03); 
            border: 1px solid rgba(0,0,0,0.04); transition: 0.3s; opacity: 0.5;
        }
        .demo-result.active .result-card { opacity: 1; transform: translateX(0); }
        
        .result-title { font-size: 11px; font-weight: 700; color: var(--text-gray); letter-spacing: 0.5px; margin-bottom: 5px; }

        /* Badges */
        .badge { display: inline-block; padding: 8px 16px; border-radius: 30px; font-size: 13px; font-weight: 800; margin-top: 5px; letter-spacing: 0.5px; }
        .badge.safe { background: #dcfce7; color: #166534; } 
        .badge.spam { background: #fee2e2; color: #991b1b; } 
        .badge.promo { background: #e0e7ff; color: #3730a3; }
        .badge.waiting { background: #f1f5f9; color: #64748b; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

        /* SUMMARY TEXT BOX */
        .summary-box {
            font-size: 14px;
            line-height: 1.6;
            color: #334155;
            white-space: pre-wrap;
            max-height: 250px;
            overflow-y: auto;
        }

        /* --- FEATURES SECTION --- */
        .features-section { 
            background: #0b0f19;
            position: relative;
            padding: 120px 20px 180px; 
            overflow: hidden;
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        .section-title { 
            position: relative; z-index: 2;
            text-align: center; margin-bottom: 90px;
            font-size: 52px; font-weight: 900; text-transform: uppercase;
            letter-spacing: 1px; line-height: 1.1;
            background: linear-gradient(to bottom, #ffffff 0%, #eef2ff 45%, #6366f1 50%, #4338ca 50%, #818cf8 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 0px rgba(255,255,255,0.2)) drop-shadow(0 10px 20px rgba(99, 102, 241, 0.5));
        }
        
        .image-grid { 
            position: relative; z-index: 2;
            display: grid; grid-template-columns: repeat(3, 1fr); 
            gap: 40px; max-width: 1200px; margin: 0 auto; 
            align-items: start;
        }
        
        .feature-card {
            background: linear-gradient(180deg, rgba(30, 41, 59, 0.6) 0%, rgba(15, 23, 42, 0.95) 100%);
            border-radius: 24px; overflow: hidden; position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1); 
            box-shadow: 0 15px 40px -10px rgba(0,0,0,0.6);
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            height: 340px; display: flex; flex-direction: column;
        }

        @media (min-width: 900px) {
            .feature-card:nth-child(3n+2) { margin-top: 80px; }
            .feature-card:nth-child(3n+3) { margin-top: 40px; }
        }
        
        .feature-card:hover { 
            transform: translateY(-15px) scale(1.02); 
            box-shadow: 0 30px 60px -10px rgba(99, 102, 241, 0.5); 
            border-color: rgba(99, 102, 241, 0.8);
            z-index: 10;
        }

        .feature-img-container { height: 200px; overflow: hidden; position: relative; }
        .feature-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s ease; filter: brightness(0.9); }
        .feature-card:hover .feature-img { transform: scale(1.2); filter: brightness(1.1); }

        .feature-label-glass {
            position: absolute; top: 20px; left: 20px; 
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff; font-size: 11px; font-weight: 900; 
            padding: 8px 16px; border-radius: 8px; 
            text-transform: uppercase; letter-spacing: 1px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 2;
        }

        .feature-content { padding: 24px; flex: 1; border-top: 1px solid rgba(255, 255, 255, 0.05); }
        .feature-desc { color: #cbd5e1; font-size: 15px; line-height: 1.6; margin: 0; }

        /* --- AUTH MODAL --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(15, 23, 42, 0.6); backdrop-filter: blur(8px); }
        .modal-content { background-color: white; margin: 10% auto; padding: 40px; border-radius: 24px; width: 400px; max-width: 90%; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); text-align: center; position: relative; }
        .modal input { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #e2e8f0; border-radius: 12px; outline: none; font-size: 15px; color: #1f1f1f; }
        .close-btn { position: absolute; right: 24px; top: 24px; cursor: pointer; font-size: 24px; color: #94a3b8; }
        
        /* --- API SECTION --- */
        .api-section { padding: 100px 20px; max-width: 1100px; margin: 0 auto; display: flex; align-items: center; gap: 60px; }
        .api-code { flex: 1; background: #1e293b; padding: 40px; border-radius: 20px; font-family: 'Courier New', monospace; color: #e2e8f0; font-size: 14px; border: 1px solid rgba(255,255,255,0.05); }
        .token { color: #38bdf8; } .string { color: #a5b4fc; }

        /* Mobile Adjustments */
        @media (max-width: 900px) {
            nav { flex-direction: column; gap: 20px; padding: 20px; }
            .nav-right { flex-direction: column; gap: 20px; width: 100%; }
            .nav-links { display: none; }
            .showcase-container { flex-direction: column; }
            .arrow-icon { transform: rotate(90deg); margin: 10px 0; }
            .demo-container { flex-direction: column; width: 95%; }
            .demo-input { border-right: none; border-bottom: 1px solid #f2f2f2; padding: 30px; }
            .analyze-btn { width: 100%; border-radius: 8px; }
            .demo-result { padding: 30px; }
            .api-section { flex-direction: column; text-align: center; }
            .hero h1 { font-size: 36px; }
            .section-title { font-size: 32px; margin-bottom: 50px; }
            .image-grid { grid-template-columns: 1fr; gap: 30px; }
            .feature-card { margin-top: 0 !important; }
        }
    </style>
</head>
<body>

    <nav>
        <a href="#" class="logo-container">
            <div class="logo-icon-box"><i class="fa-solid fa-shield-virus"></i></div>
            <div class="logo-text">NeuralShield</div>
        </a>
        <div class="nav-right">
            <div class="nav-links">
                <a href="#">Products</a><a href="#">Solutions</a><a href="#">Pricing</a>
            </div>
            <div class="auth-buttons">
                <div id="guest-nav">
                    <button class="btn-nav btn-outline" onclick="openModal('login')">Log In</button>
                    <button class="btn-nav" style="margin-left: 10px;" onclick="openModal('signup')">Sign Up</button>
                </div>
                <div id="user-menu" style="display:none; align-items:center; gap:15px;">
                    <span style="font-weight:600; font-size:14px;">Hi, <span id="userNameDisplay">User</span></span>
                    <a href="/logout" class="btn-nav" style="background:#ef4444; padding: 8px 16px; box-shadow:none;">Log Out</a>
                </div>
            </div>
        </div>
    </nav>

    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="document.getElementById('authModal').style.display='none'">&times;</span>
            <h2 id="modalTitle" style="margin-top:0; color:#1f1f1f;">Login</h2>
            <input type="text" id="nameInput" placeholder="Full Name" style="display:none;">
            <input type="email" id="emailInput" placeholder="work@email.com">
            <input type="password" id="passwordInput" placeholder="Password">
            <button class="analyze-btn" style="width:100%; border-radius:8px;" onclick="submitAuth()" id="authSubmitBtn">Log In</button>
            <span style="color:var(--primary); cursor:pointer; font-size:14px; display:block; margin-top:24px; font-weight:600;" onclick="toggleAuthMode()" id="toggleText">Don't have an account? Sign Up</span>
        </div>
    </div>

    <div id="offline-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: #0f172a; z-index:9999; flex-direction:column; justify-content:center; align-items:center; text-align:center;">
        <div style="font-size: 80px; color: #ef4444; margin-bottom: 20px; animation: pulseWifi 2s infinite;">
            <i class="fa-solid fa-wifi"></i>
        </div>
        <h1 style="font-size: 32px; font-weight: 900; color: white; margin-bottom: 10px;">Connection Lost</h1>
        <p style="color: #94a3b8; font-size: 16px; margin-bottom: 30px; max-width: 300px;">
            NeuralShield cannot reach the server. Please check your internet connection.
        </p>
        <button onclick="checkConnection()" style="padding: 14px 32px; background: #6366f1; color: white; border: none; border-radius: 50px; font-weight: 700; cursor: pointer; font-size: 16px; transition: transform 0.2s;">
            <i class="fa-solid fa-rotate-right"></i> Try Again
        </button>
        <style>
            @keyframes pulseWifi { 
                0% { opacity: 1; transform: scale(1); } 
                50% { opacity: 0.5; transform: scale(0.95); } 
                100% { opacity: 1; transform: scale(1); } 
            }
        </style>
    </div>

    <div class="hero">
        <h1>Detect AI Content, Spam & Fraud at Scale</h1>
        <p>The enterprise standard for detecting AI-generated text, phishing attempts, and manipulated images.</p>
    </div>

    <div class="showcase-container">
        <img src="{{ url_for('static', filename='demo_input.png') }}" alt="Input" class="showcase-img">
        <div class="arrow-icon"><i class="fa-solid fa-arrow-right-long"></i></div>
        <img src="{{ url_for('static', filename='demo_output.png') }}" alt="Output" class="showcase-img">
    </div>

    <div class="demo-section-title">Interactive Diagnostic Tool</div>

    <div class="mode-container">
        <div class="mode-switch">
            <button class="mode-btn active" id="btnSpam" onclick="setMode('spam')">
                <i class="fa-solid fa-shield-halved"></i> Detect Spam
            </button>
            <button class="mode-btn" id="btnSummary" onclick="setMode('summary')">
                <i class="fa-solid fa-file-lines"></i> Summarize PDF
            </button>
        </div>
    </div>

    <div class="demo-container">
        <div class="demo-input">
            <div class="drop-zone" onclick="document.getElementById('fileInput').click()">
                <i class="fa-solid fa-cloud-arrow-up" style="font-size: 32px; margin-bottom:12px; color:var(--primary);"></i><br>
                <strong>Drag & Drop File</strong><br>
                <span style="font-size: 13px; color:var(--text-gray);">Supports .txt, .pdf, .eml, .png, .jpg</span>
                <input type="file" id="fileInput" hidden accept=".txt,.pdf,.eml,.png,.jpg">
            </div>
            <div id="fileStatus" class="file-status"></div>
            <textarea id="mainTextInput" placeholder="Paste your text, email content, or upload a file..."></textarea>
            <button onclick="runDiagnostics()" class="analyze-btn" id="runBtn">Run AI Diagnostics</button>
        </div>

        <div class="demo-result" id="resultArea">
            
            <div id="spamResults">
                <div class="result-card">
                    <div class="result-title">PREDICTION</div>
                    <div id="statusBadge" class="badge waiting">Waiting for input...</div>
                </div>
                <div class="result-card">
                    <div class="result-title">CONFIDENCE SCORE</div>
                    <div id="confValue" style="font-size:24px; font-weight:800; color:#1f1f1f; margin-top:5px;">-- %</div>
                    <div style="width: 100%; height: 6px; background: #f1f5f9; margin-top: 10px; border-radius:3px; overflow:hidden;">
                        <div id="meterFill" style="width: 0%; height: 100%; background: var(--primary); border-radius: 3px; transition: 1s cubic-bezier(0.4, 0, 0.2, 1);"></div>
                    </div>
                </div>
                <div class="result-card">
                    <div class="result-title">AI FORENSICS</div>
                    <div id="insightText" style="font-size:14px; margin-top:8px; color:#1f1f1f; line-height:1.5;">--</div>
                </div>
                <div class="result-card" id="linkSection" style="display:none;">
                    <div class="result-title">SUSPICIOUS LINKS</div>
                    <div id="linkList" style="margin-top:10px;"></div>
                </div>
            </div>

            <div id="summaryResult" style="display:none;">
                <div class="result-card" style="opacity: 1; border-left: 4px solid var(--primary);">
                    <div class="result-title" style="color:var(--primary);">DOCUMENT SUMMARY</div>
                    <div id="summaryText" class="summary-box">
                        Upload a PDF or text file to see the AI-generated summary here.
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="features-section">
        <div class="features-bg-glow"></div>
        <div class="section-title">Comprehensive Threat Protection</div>
        <div class="image-grid">
            <div class="feature-card">
                <div class="feature-img-container"><img src="{{ url_for('static', filename='f1.jpg') }}" class="feature-img"></div>
                <div class="feature-label-glass">MISINFORMATION</div>
                <div class="feature-content"><p class="feature-desc">Identifies AI-generated fake news and deepfakes instantly.</p></div>
            </div>
            <div class="feature-card">
                <div class="feature-img-container"><img src="{{ url_for('static', filename='f2.jpg') }}" class="feature-img"></div>
                <div class="feature-label-glass">INSURANCE FRAUD</div>
                <div class="feature-content"><p class="feature-desc">Detects manipulated images in property insurance claims.</p></div>
            </div>
            <div class="feature-card">
                <div class="feature-img-container"><img src="{{ url_for('static', filename='f3.jpg') }}" class="feature-img"></div>
                <div class="feature-label-glass">FAKE PROFILES</div>
                <div class="feature-content"><p class="feature-desc">Flags AI-generated profile pictures used by bots and scammers.</p></div>
            </div>
            <div class="feature-card">
                <div class="feature-img-container"><img src="{{ url_for('static', filename='f4.jpg') }}" class="feature-img"></div>
                <div class="feature-label-glass">ID VERIFICATION</div>
                <div class="feature-content"><p class="feature-desc">Prevents KYC bypass attempts with fake or spoofed IDs.</p></div>
            </div>
            <div class="feature-card">
                <div class="feature-img-container"><img src="{{ url_for('static', filename='f5.jpg') }}" class="feature-img"></div>
                <div class="feature-label-glass">MARKETPLACE SPAM</div>
                <div class="feature-content"><p class="feature-desc">Stops mass-uploading of auto-generated product images.</p></div>
            </div>
            <div class="feature-card">
                <div class="feature-img-container"><img src="{{ url_for('static', filename='f6.jpg') }}" class="feature-img"></div>
                <div class="feature-label-glass">FAKE EVIDENCE</div>
                <div class="feature-content"><p class="feature-desc">Analyzes accident reports for pixel manipulation and edits.</p></div>
            </div>
        </div>
    </div>

    <div class="api-section">
        <div style="flex:1;">
            <h2 style="font-size: 36px; font-weight:800; color:var(--text-light); margin-bottom:20px;">Built for Developers</h2>
            <p style="color:var(--text-gray); font-size:18px; line-height:1.6; margin-bottom:30px;">Integrate enterprise-grade detection via API.</p>
            <button class="btn-nav" style="background:var(--text-light); color:black;">Read Documentation</button>
        </div>
        <div class="api-code">
            <span class="token">import</span> requests<br><br>
            res = requests.post(<span class="string">'https://api.neuralshield.com/check'</span>, json={<span class="string">'text'</span>: <span class="string">'Urgent Verify'</span>})<br>
            <span class="token">print</span>(res.json())
        </div>
    </div>

   <script>
        let isLoginMode = true;
        let currentMode = 'spam'; // Default Mode
        let storedSummary = "";   // Holds the summary from backend

        // --- OFFLINE DETECTION LOGIC ---
        function checkConnection() {
            const overlay = document.getElementById('offline-overlay');
            if (navigator.onLine) {
                overlay.style.display = 'none';
            } else {
                overlay.style.display = 'flex';
            }
        }
        window.addEventListener('offline', () => { document.getElementById('offline-overlay').style.display = 'flex'; });
        window.addEventListener('online', () => { document.getElementById('offline-overlay').style.display = 'none'; });
        checkConnection(); // Run on load

        // --- MODE SWITCHING LOGIC ---
        function setMode(mode) {
            currentMode = mode;
            
            // Toggle Buttons UI
            document.getElementById('btnSpam').className = mode === 'spam' ? 'mode-btn active' : 'mode-btn';
            document.getElementById('btnSummary').className = mode === 'summary' ? 'mode-btn active' : 'mode-btn';
            
            // Update Main Button Text
            const btn = document.getElementById('runBtn');
            btn.innerText = mode === 'spam' ? "Run AI Diagnostics" : "Generate Summary";
            
            // Toggle Result Areas
            document.getElementById('spamResults').style.display = mode === 'spam' ? 'block' : 'none';
            document.getElementById('summaryResult').style.display = mode === 'summary' ? 'block' : 'none';
        }

        async function checkLoginStatus() {
            try {
                const res = await fetch('/get_user_status');
                const data = await res.json();
                if(data.is_logged_in) {
                    document.getElementById('guest-nav').style.display = 'none';
                    document.getElementById('user-menu').style.display = 'flex';
                    document.getElementById('userNameDisplay').innerText = data.name;
                }
            } catch(e) {}
        }
        checkLoginStatus();

        function openModal(mode) {
            document.getElementById('authModal').style.display = 'block';
            isLoginMode = (mode === 'login');
            updateModalUI();
        }
        function toggleAuthMode() { isLoginMode = !isLoginMode; updateModalUI(); }
        function updateModalUI() {
            document.getElementById('modalTitle').innerText = isLoginMode ? "Login" : "Create Account";
            document.getElementById('authSubmitBtn').innerText = isLoginMode ? "Log In" : "Sign Up";
            document.getElementById('toggleText').innerText = isLoginMode ? "Don't have an account? Sign Up" : "Already have an account? Log In";
            document.getElementById('nameInput').style.display = isLoginMode ? "none" : "block";
        }
        async function submitAuth() {
            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;
            const name = document.getElementById('nameInput').value;
            const endpoint = isLoginMode ? '/login' : '/signup';
            const res = await fetch(endpoint, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ email, password, name }) });
            const data = await res.json();
            if(res.ok) { alert(data.message); document.getElementById('authModal').style.display = 'none'; checkLoginStatus(); } else { alert(data.error); }
        }

        // --- FIXED FILE UPLOAD SECTION ---
        document.getElementById('fileInput').addEventListener('change', async function() {
            if(this.files[0]) {
                const file = this.files[0];
                const textarea = document.getElementById('mainTextInput');
                const fileStatus = document.getElementById('fileStatus');
                fileStatus.innerText = "ðŸ“Ž Attached: " + file.name;
                fileStatus.style.display = 'block';
                textarea.value = "â³ Scanning document...";
                
                const formData = new FormData();
                formData.append('file', file);
                
                try {
                    const res = await fetch('/process_file', { method: 'POST', body: formData });
                    
                    // CHECK FOR HTML ERROR
                    const contentType = res.headers.get("content-type");
                    if (!contentType || !contentType.includes("application/json")) {
                        textarea.value = "âŒ SERVER ERROR: The server crashed (Memory Limit). Try a smaller file.";
                        return;
                    }

                    const data = await res.json();
                    
                    if (data.error) {
                        textarea.value = "Error: " + data.error;
                    } else {
                        // 1. Show Extracted Text
                        textarea.value = data.email_text || "[OCR Complete] No readable text found.";
                        
                        // 2. Store Summary for later
                        storedSummary = data.summary || "No summary available for this document.";

                        // 3. If we are already in Summary Mode, show it now
                        if (currentMode === 'summary') {
                            document.getElementById('summaryText').innerText = storedSummary;
                        }
                    }

                } catch(e) { 
                    console.error(e);
                    // CHECK FOR OFFLINE
                    if(!navigator.onLine) document.getElementById('offline-overlay').style.display = 'flex';
                    textarea.value = "âš ï¸ NETWORK ERROR: " + e.message; 
                }
            }
        });

        async function runDiagnostics() {
            const text = document.getElementById('mainTextInput').value;
            const resultArea = document.getElementById('resultArea');
            const btn = document.getElementById('runBtn');
            
            if(!text || text.startsWith("â³")) { alert("Please wait for scan or enter text."); return; }
            
            resultArea.classList.add('active');
            btn.disabled = true;

            // --- MODE A: SUMMARY ---
            if (currentMode === 'summary') {
                btn.innerText = "Generating...";
                setTimeout(() => {
                    // Show the summary we stored during upload, or a placeholder
                    document.getElementById('summaryText').innerText = storedSummary || "Summary generated from uploaded PDF will appear here.";
                    btn.innerText = "Generate Summary";
                    btn.disabled = false;
                }, 800);
            }
            // --- MODE B: SPAM CHECK ---
            else {
                const badge = document.getElementById('statusBadge');
                badge.className = 'badge waiting'; 
                badge.innerText = "Analyzing...";
                btn.innerText = "Running Scan...";
                
                setTimeout(async () => {
                    try {
                        const res = await fetch('/predict', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({text: text}) });
                        const data = await res.json();
                        
                        badge.className = 'badge ' + data.result;
                        badge.innerText = data.result === 'spam' ? "â›” SPAM DETECTED" : (data.result === 'promo' ? "ðŸ“¢ PROMOTION" : "âœ… VERIFIED SAFE");
                        
                        document.getElementById('confValue').innerText = data.confidence + "%";
                        document.getElementById('meterFill').style.width = data.confidence + "%";
                        document.getElementById('meterFill').style.backgroundColor = data.result === 'spam' ? '#d93025' : (data.result === 'promo' ? '#1a73e8' : '#137333');
                        
                        document.getElementById('insightText').innerText = data.insight;
                        
                        const linkDiv = document.getElementById('linkList'); const linkSection = document.getElementById('linkSection'); linkDiv.innerHTML = "";
                        if(data.links && data.links.length > 0) {
                            linkSection.style.display = 'block';
                            data.links.forEach(l => {
                                const color = l.risk.includes("High") ? "color:#d93025; font-weight:bold;" : "color:#137333;";
                                linkDiv.innerHTML += `<div style="font-size:12px; padding:6px 0; border-bottom:1px solid #f2f2f2; display:flex; justify-content:space-between;"><span>${l.url.substring(0,30)}...</span> <span style="${color}">${l.risk}</span></div>`;
                            });
                        } else { linkSection.style.display = 'none'; }
                    } catch(e) { 
                        // CHECK FOR OFFLINE
                        if(!navigator.onLine) document.getElementById('offline-overlay').style.display = 'flex';
                        else alert("Connection Error"); 
                    }
                    btn.innerText = "Run AI Diagnostics"; btn.disabled = false;
                }, 1500);
            }
        }
    </script>
</body>
</html>